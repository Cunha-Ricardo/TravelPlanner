import openai
import time

# Sua API key e assistant id
openai.api_key = "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"
assistant_id = "asst_lGYYrCgs2YomNqb1mgFmvFz5"

def criar_checklist(destino, dias, preferencias):
    prompt = f"""
Vou fazer uma viagem e preciso de um checklist inteligente e completo. Considere o destino, a quantidade de dias e o tipo de viagem (ex: lazer, trabalho, aventura, etc). Me ajude a organizar os itens que devo levar, divididos por categorias como: documentos, roupas, eletrônicos, higiene pessoal, saúde, acessórios, e outros essenciais. Deixe a lista clara, organizada e com sugestões úteis que pessoas costumam esquecer.

Destino: {destino}
Duração: {dias} dias
Tipo de viagem: {preferencias}

Crie a lista no formato de checklist, com marcadores e separação por categoria.
"""

    # Criar thread
    thread = openai.beta.threads.create()

    # Enviar mensagem do usuário com o prompt
    openai.beta.threads.messages.create(
        thread_id=thread.id,
        role="user",
        content=prompt
    )

    # Executar o assistente
    run = openai.beta.threads.runs.create(
        thread_id=thread.id,
        assistant_id=assistant_id
    )

    print("Gerando checklist, aguarde...", end="", flush=True)
    while True:
        run_status = openai.beta.threads.runs.retrieve(thread_id=thread.id, run_id=run.id)
        if run_status.status == "completed":
            break
        print(".", end="", flush=True)
        time.sleep(1)
    print("\n")

    # Pegar resposta da thread
    messages = openai.beta.threads.messages.list(thread_id=thread.id)

    checklist_texto = ""
    for msg in messages.data[::-1]:
        if msg.role == "assistant":
            checklist_texto = msg.content[0].text.value
            return checklist_texto

if __name__ == "__main__":
    destino = input("Destino da viagem: ")
    dias = input("Duração (em dias): ")
    preferencias = input("Tipo de viagem (ex: lazer, trabalho, aventura): ")

    checklist = criar_checklist(destino, dias, preferencias)
    print("\nChecklist inteligente para sua viagem:\n")
    print(checklist)
